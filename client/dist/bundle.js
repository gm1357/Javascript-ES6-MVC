!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}n.r(t);var r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._negociacoes=[]}var t,n,r;return t=e,(n=[{key:"adiciona",value:function(e){this._negociacoes.push(e)}},{key:"esvazia",value:function(){this._negociacoes=[]}},{key:"ordena",value:function(e){this._negociacoes.sort(e)}},{key:"inverteOrdem",value:function(){this._negociacoes.reverse()}},{key:"negociacoes",get:function(){return[].concat(this._negociacoes)}},{key:"volumeTotal",get:function(){return this._negociacoes.reduce(function(e,t){return e+t.volume},0)}}])&&o(t.prototype,n),r&&o(t,r),e}();function a(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var i=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._texto=t}var t,n,o;return t=e,(n=[{key:"texto",get:function(){return this._texto},set:function(e){this._texto=e}}])&&a(t.prototype,n),o&&a(t,o),e}();function c(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var u=function(){function e(t,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._data=new Date(t.getTime()),this._quantidade=n,this._valor=o,Object.freeze(this)}var t,n,o;return t=e,(n=[{key:"isEquals",value:function(e){return JSON.stringify(this)==JSON.stringify(e)}},{key:"data",get:function(){return new Date(this._data.getTime())}},{key:"quantidade",get:function(){return this._quantidade}},{key:"valor",get:function(){return this._valor}},{key:"volume",get:function(){return this._quantidade*this._valor}}])&&c(t.prototype,n),o&&c(t,o),e}();function s(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var f=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._elemento=t}var t,n,o;return t=e,(n=[{key:"template",value:function(){throw new Error("O método template deve ser implementado")}},{key:"update",value:function(e){this._elemento.innerHTML=this.template(e)}}])&&s(t.prototype,n),o&&s(t,o),e}();function l(e,t,n){return(l=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,n){var o=[null];o.push.apply(o,t);var r=new(Function.bind.apply(e,o));return n&&p(r,n.prototype),r}).apply(null,arguments)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function h(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function y(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var v=function(){function e(){throw function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),new Error("Está classe não pode ser instanciada")}var t,n,o;return t=e,o=[{key:"textoParaData",value:function(e){if(!/^\d{4}-\d{2}-\d{2}$/.test(e))throw new Error("Deve estar no formato aaaa-mm-dd");return l(Date,h(e.split("-").map(function(e,t){return e-t%2})))}},{key:"dataParaTexto",value:function(e){return"".concat(e.getDate(),"/").concat(e.getMonth()+1,"/").concat(e.getFullYear())}}],(n=null)&&y(t.prototype,n),o&&y(t,o),e}();function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function g(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function b(e,t){return!t||"object"!==d(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function w(e,t){return(w=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var _=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=b(this,m(t).call(this,e)),e.addEventListener("click",function(e){"TH"==e.target.nodeName&&U().ordena(e.target.textContent.toLowerCase())}),n}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&w(e,t)}(t,f),n=t,(o=[{key:"template",value:function(e){return'\n        <table class="table table-hover table-bordered">\n            <thead>\n                <tr>\n                    <th>DATA</th>\n                    <th>QUANTIDADE</th>\n                    <th>VALOR</th>\n                    <th>VOLUME</th>\n                </tr>\n            </thead>\n            \n            <tbody>\n                '.concat(e.negociacoes.map(function(e){return"\n                    <tr>\n                        <td>".concat(v.dataParaTexto(e.data),"</td>\n                        <td>").concat(e.quantidade,"</td>\n                        <td>").concat(e.valor,"</td>\n                        <td>").concat(e.volume,"</td>\n                    </tr>\n                ")}).join(""),'\n            </tbody>\n            \n            <tfoot>\n                <td colspan="3"></td>\n                <td>').concat(e.volumeTotal,"</td>\n            </tfoot>\n        </table>\n        ")}}])&&g(n.prototype,o),r&&g(n,r),t}();function k(e){return(k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function O(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function j(e,t){return!t||"object"!==k(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function E(e){return(E=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function S(e,t){return(S=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var N=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),j(this,E(t).apply(this,arguments))}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&S(e,t)}(t,f),n=t,(o=[{key:"template",value:function(e){return e.texto?'<p class="alert alert-info">'.concat(e.texto,"</p>"):"<p></p>"}}])&&O(n.prototype,o),r&&O(n,r),t}();function P(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var T=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,o;return t=e,(n=[{key:"_handleErrors",value:function(e){if(!e.ok)throw new Error(e.statusText);return e}},{key:"get",value:function(e){var t=this;return fetch(e).then(function(e){return t._handleErrors(e)}).then(function(e){return e.json()})}},{key:"post",value:function(e,t){var n=this;return fetch(e,{headers:{"Content-type":"application/json"},method:"post",body:JSON.stringify(t)}).then(function(e){return n._handleErrors(e)})}}])&&P(t.prototype,n),o&&P(t,o),e}();function x(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var D=["negociacoes"],C=null,A=null,q=function(){function e(){throw function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),new Error("Não é possível criar instâncias de ConnectionFactory")}var t,n,o;return t=e,o=[{key:"getConnection",value:function(){return new Promise(function(t,n){var o=window.indexedDB.open("aluraframe",3);o.onupgradeneeded=function(t){e._createStores(t.target.result)},o.onsuccess=function(e){C||(C=e.target.result,A=C.close.bind(C),C.close=function(){throw new Error("Você não pode fechar a conexão")}),t(e.target.result)},o.onerror=function(e){console.log(e.target.error),n(e.target.error.name)}})}},{key:"closeConnection",value:function(){C&&(A(),C=null)}},{key:"_createStores",value:function(e){D.forEach(function(t){e.objectStoreNames.contains(t)&&e.deleteObjectStore(t),e.createObjectStore(t,{autoIncrement:!0})})}}],(n=null)&&x(t.prototype,n),o&&x(t,o),e}();function R(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var F=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._connection=t,this._store="negociacoes"}var t,n,o;return t=e,(n=[{key:"adiciona",value:function(e){var t=this;return new Promise(function(n,o){var r=t._connection.transaction([t._store],"readwrite").objectStore(t._store).add(e);r.onsuccess=function(e){n()},r.onerror=function(e){console.log(e.target.error),o("Não foi possível adicionar a negociação")}})}},{key:"listaTodos",value:function(){var e=this;return new Promise(function(t,n){var o=e._connection.transaction([e._store],"readwrite").objectStore(e._store).openCursor(),r=[];o.onsuccess=function(e){var n=e.target.result;if(n){var o=n.value;r.push(new u(o._data,o._quantidade,o._valor)),n.continue()}else t(r)},o.onerror=function(e){console.log(e.target.error),n("Não foi possível listar as negociações")}})}},{key:"apagaTodos",value:function(){var e=this;return new Promise(function(t,n){var o=e._connection.transaction([e._store],"readwrite").objectStore(e._store).clear();o.onsuccess=function(e){return t("Negociações apagadas com sucesso")},o.onerror=function(e){console.log(e.target.error),n("Não foi possível apagar as negociações")}})}}])&&R(t.prototype,n),o&&R(t,o),e}();function V(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var M=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._http=new T}var t,n,o;return t=e,(n=[{key:"obterNegociacoesDaSemana",value:function(){return this._http.get("negociacoes/semana").then(function(e){return console.log(e),e.map(function(e){return new u(new Date(e.data),e.quantidade,e.valor)})}).catch(function(e){throw console.log(e),new Error("Não foi possível obter as negociações da semana")})}},{key:"obterNegociacoesDaSemanaAnterior",value:function(){return this._http.get("negociacoes/anterior").then(function(e){return console.log(e),e.map(function(e){return new u(new Date(e.data),e.quantidade,e.valor)})}).catch(function(e){throw console.log(e),new Error("Não foi possível obter as negociações da semana anterior")})}},{key:"obterNegociacoesDaSemanaRetrasada",value:function(){return this._http.get("negociacoes/retrasada").then(function(e){return console.log(e),e.map(function(e){return new u(new Date(e.data),e.quantidade,e.valor)})}).catch(function(e){throw console.log(e),new Error("Não foi possível obter as negociações da semana retrasada")})}},{key:"obterNegociacoes",value:function(){return Promise.all([this.obterNegociacoesDaSemana(),this.obterNegociacoesDaSemanaAnterior(),this.obterNegociacoesDaSemanaRetrasada()]).then(function(e){return e.reduce(function(e,t){return e.concat(t)},[])}).catch(function(e){throw new Error(e)})}},{key:"cadastra",value:function(e){return q.getConnection().then(function(e){return new F(e)}).then(function(t){return t.adiciona(e)}).then(function(){return"Negociação adicionada com sucesso"}).catch(function(e){throw console.log(e),new Error("Não foi possível adicionar a negociação")})}},{key:"lista",value:function(){return q.getConnection().then(function(e){return new F(e)}).then(function(e){return e.listaTodos()}).catch(function(e){throw console.log(e),new Error("Não foi possível listar as negociações")})}},{key:"apaga",value:function(){return q.getConnection().then(function(e){return new F(e)}).then(function(e){return e.apagaTodos()}).then(function(){return"Negociações apagadas com sucesso"}).catch(function(e){throw console.log(e),new Error("Não foi possível apagar as negociações")})}},{key:"importa",value:function(e){return this.obterNegociacoes().then(function(t){return t.filter(function(t){return!e.some(function(e){return e.isEquals(t)})})}).catch(function(e){throw console.log(e),new Error("Não foi possível importar negociações")})}}])&&V(t.prototype,n),o&&V(t,o),e}();function I(e){return(I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function L(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var z=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,o;return t=e,o=[{key:"create",value:function(t,n,o){return new Proxy(t,{get:function(t,r,a){return n.includes(r)&&e._ehFuncao(t[r])?function(){var e=Reflect.apply(t[r],t,arguments);return o(t),e}:Reflect.get(t,r,a)},set:function(e,t,r,a){var i=Reflect.set(e,t,r,a);return n.includes(t)&&o(e),i}})}},{key:"_ehFuncao",value:function(e){return I(e)==("undefined"==typeof Function?"undefined":I(Function))}}],(n=null)&&L(t.prototype,n),o&&L(t,o),e}();var Q=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);for(var o=arguments.length,r=new Array(o>2?o-2:0),a=2;a<o;a++)r[a-2]=arguments[a];var i=z.create(t,r,function(e){return n.update(e)});return n.update(t),i};function J(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var H=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var t=document.querySelector.bind(document);this._inputData=t("#data"),this._inputQuantidade=t("#quantidade"),this._inputValor=t("#valor"),this._ordemAtual="",this._listaNegociacoes=new Q(new r,new _(t("#negociacoesView")),"adiciona","esvazia","ordena","inverteOrdem"),this._mensagem=new Q(new i,new N(t("#mensagemView")),"texto"),this._service=new M,this._init()}var t,n,o;return t=e,(n=[{key:"_init",value:function(){var e=this;this._service.lista().then(function(t){return t.forEach(function(t){return e._listaNegociacoes.adiciona(t)})}).catch(function(t){return e._mensagem.texto=t}),setInterval(function(){e.importaNegociacoes()},3e3)}},{key:"adiciona",value:function(e){var t=this;e.preventDefault();var n=this._criaNegociacao();this._service.cadastra(n).then(function(e){t._listaNegociacoes.adiciona(n),t._mensagem.texto=e,t._limpaFormulario()}).catch(function(e){return t._mensagem.texto=e})}},{key:"importaNegociacoes",value:function(){var e=this;this._service.importa(this._listaNegociacoes.negociacoes).then(function(t){t.forEach(function(t){return e._listaNegociacoes.adiciona(t)}),e._mensagem.texto="Negociações do período importadas com sucesso"}).catch(function(t){return e._mensagem.texto=t})}},{key:"ordena",value:function(e){this._ordemAtual==e?this._listaNegociacoes.inverteOrdem():this._listaNegociacoes.ordena(function(t,n){return t[e]-n[e]}),this._ordemAtual=e}},{key:"apaga",value:function(){var e=this;this._service.apaga().then(function(t){e._mensagem.texto=t,e._listaNegociacoes.esvazia()}).catch(function(t){return e._mensagem.texto=t})}},{key:"_criaNegociacao",value:function(){return new u(v.textoParaData(this._inputData.value),parseInt(this._inputQuantidade.value),parseFloat(this._inputValor.value))}},{key:"_limpaFormulario",value:function(){this._inputData.value="",this._inputQuantidade.value=1,this._inputValor.value=0,this._inputData.focus()}}])&&J(t.prototype,n),o&&J(t,o),e}());function U(){return H}var B=new U;document.querySelector(".form").onsubmit=B.adiciona.bind(B),document.querySelector("[type=button]").onclick=B.apaga.bind(B)}]);